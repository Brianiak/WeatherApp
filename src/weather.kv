#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp
#:import get_color_from_hex kivy.utils.get_color_from_hex


<SegmentButton@ToggleButton>:
    background_normal: ""
    background_down: ""
    background_color: 0, 0, 0, 0
    font_size: sp(14)
    color: get_color_from_hex("#1E1E1E")

    canvas.before:
        Color:
            rgba: get_color_from_hex("#A7D8FF") if self.state == "down" else (0, 0, 0, 0)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(16), ]


<SegmentedControl@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: dp(46)
    padding: dp(3)
    spacing: dp(3)

    canvas.before:
        Color:
            rgba: get_color_from_hex("#EAF2F8")
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20), ]
        Color:
            rgba: get_color_from_hex("#C7D3DD")
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(20))
            width: 1

    SegmentButton:
        id: btn_today
        text: "Heute"
        group: "forecast"
        on_release: app.navigate("today")

    SegmentButton:
        id: btn_tomorrow
        text: "Morgen"
        group: "forecast"
        on_release: app.navigate("tomorrow")

    SegmentButton:
        id: btn_5days
        text: "5 Tage"
        group: "forecast"
        on_release: app.navigate("5days")
    
<WeatherCard@BoxLayout>:
    orientation: "vertical"
    padding: dp(22)
    spacing: dp(18)

    canvas.before:
        Color:
            rgba: get_color_from_hex("#FFFFFF")
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(18), ]
        Color:
            rgba: get_color_from_hex("#DCE6EE")
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(18))
            width: 1


<Separator@Widget>:
    size_hint_y: None
    height: dp(1)
    canvas.before:
        Color:
            rgba: (0, 0, 0, 0.25)
        Rectangle:
            pos: self.pos
            size: self.size


<HourForecast@BoxLayout>:
    orientation: "vertical"
    size_hint: None, None
    width: dp(100)
    height: dp(140)
    padding: (dp(8), dp(6))
    spacing: dp(6)
    
    time_text: ""
    icon_source: "icons/01d.png"
    temp_text: "--Â°"
    desc_text: ""
    
    Label:
        text: root.time_text
        size_hint_y: None
        height: dp(30)
        font_size: sp(15)
        bold: True
        halign: "center"
        valign: "middle"
        text_size: (dp(96), dp(30))
        color: get_color_from_hex("#1E1E1E")
    
    Image:
        source: root.icon_source
        size_hint: None, None
        size: (dp(50), dp(50))
        pos_hint: {"center_x": 0.5}
        allow_stretch: True
        keep_ratio: True
    
    Label:
        text: root.temp_text
        font_size: sp(20)
        bold: True
        size_hint_y: None
        height: dp(28)
        halign: "center"
        valign: "middle"
        text_size: (dp(96), dp(28))
        color: get_color_from_hex("#1E1E1E")
    
    Label:
        text: root.desc_text
        font_size: sp(12)
        size_hint_y: None
        height: dp(16)
        halign: "center"
        valign: "middle"
        text_size: (dp(80), dp(16))
        color: get_color_from_hex("#6B6B6B")


<ForecastRow>:
    orientation: "vertical"
    size_hint_y: None
    height: dp(66)
    spacing: dp(6)

    BoxLayout:
        orientation: "horizontal"
        size_hint_y: None
        height: dp(58)
        padding: dp(8), dp(6)
        spacing: dp(10)

        Label:
            text: root.date_text
            size_hint_x: 0.35
            halign: "left"
            valign: "middle"
            text_size: self.size
            font_size: sp(14)
            color: get_color_from_hex("#1E1E1E")

        AnchorLayout:
            size_hint_x: 0.30
            anchor_x: "center"
            anchor_y: "center"

            BoxLayout:
                orientation: "horizontal"
                size_hint: None, None
                width: dp(108)
                height: dp(36)
                spacing: dp(2)

                ForecastIcon:
                    source: root.icon_source
                    size_hint: None, None
                    size: dp(36), dp(36)
                    allow_stretch: True
                    keep_ratio: True

                Label:
                    text: root.minmax_text
                    size_hint: None, None
                    width: dp(70)
                    height: dp(36)
                    halign: "center"
                    valign: "middle"
                    text_size: self.size
                    font_size: sp(14)
                    color: get_color_from_hex("#1E1E1E")

        Label:
            text: root.dayparts_text
            size_hint_x: 0.35
            halign: "right"
            valign: "middle"
            text_size: self.size
            font_size: sp(13)
            color: get_color_from_hex("#1E1E1E")

    Separator:


<CenteredLabel@Label>:
    halign: "center"
    valign: "middle"
    text_size: self.size
    color: get_color_from_hex("#1E1E1E")


<TodayScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        WeatherCard:
            size_hint: None, None
            width: root.card_width
            height: min(root.height - dp(40), dp(720))

            BoxLayout:
                orientation: "vertical"
                spacing: dp(14)

                SegmentedControl:
                    id: nav

                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"

                    BoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint: None, None
                        width: dp(260)
                        height: dp(320)

                        Image:
                            source: root.location_icon_source
                            size_hint: None, None
                            size: dp(34), dp(34)
                            pos_hint: {"center_x": 0.5}

                        CenteredLabel:
                            text: root.location_text
                            font_size: sp(22)
                            bold: True

                        Image:
                            source: root.weather_icon
                            size_hint: None, None
                            size: dp(110), dp(110)
                            pos_hint: {"center_x": 0.5}
                            allow_stretch: True
                            keep_ratio: True

                        CenteredLabel:
                            text: root.temp_text
                            font_size: sp(48)
                            bold: True

                        CenteredLabel:
                            text: root.condition_text
                            font_size: sp(16)
                            color: get_color_from_hex("#6B6B6B")

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: dp(170)
                    padding: dp(12)

                    canvas.before:
                        Color:
                            rgba: get_color_from_hex("#FFFFFF")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12), ]
                        # subtle gray border instead of the blue frame used in mockups
                        Color:
                            rgba: get_color_from_hex("#DCE6EE")
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
                            width: 1

                    ScrollView:
                        id: hourly_scroll
                        do_scroll_y: False
                        bar_width: dp(6)
                        scroll_type: ["bars", "content"]

                        BoxLayout:
                            id: hourly_box
                            orientation: "horizontal"
                            size_hint_x: None
                            height: dp(140)
                            width: self.minimum_width
                            spacing: dp(10)


<TomorrowScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        WeatherCard:
            size_hint: None, None
            width: root.card_width
            height: min(root.height - dp(40), dp(720))

            BoxLayout:
                orientation: "vertical"
                spacing: dp(14)

                SegmentedControl:
                    id: nav

                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"

                    BoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint: None, None
                        width: dp(260)
                        height: dp(320)

                        Image:
                            source: root.location_icon_source
                            size_hint: None, None
                            size: dp(34), dp(34)
                            pos_hint: {"center_x": 0.5}

                        CenteredLabel:
                            text: root.location_text
                            font_size: sp(22)
                            bold: True

                        Image:
                            source: root.weather_icon
                            size_hint: None, None
                            size: dp(110), dp(110)
                            pos_hint: {"center_x": 0.5}
                            allow_stretch: True
                            keep_ratio: True

                        CenteredLabel:
                            text: root.minmax_text
                            font_size: sp(48)
                            bold: True

                        CenteredLabel:
                            text: root.condition_text
                            font_size: sp(16)
                            color: get_color_from_hex("#6B6B6B")

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: dp(170)
                    padding: dp(12)

                    canvas.before:
                        Color:
                            rgba: get_color_from_hex("#FFFFFF")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12), ]
                        Color:
                            rgba: get_color_from_hex("#DCE6EE")
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
                            width: 1

                    ScrollView:
                        id: hourly_scroll
                        do_scroll_y: False
                        bar_width: dp(6)
                        scroll_type: ["bars", "content"]

                        BoxLayout:
                            id: hourly_box
                            orientation: "horizontal"
                            size_hint_x: None
                            height: dp(140)
                            width: self.minimum_width
                            spacing: dp(10)


<FiveDaysScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        WeatherCard:
            id: card
            size_hint: None, None
            width: root.card_width
            height: min(root.height - dp(40), dp(720))

            BoxLayout:
                orientation: "vertical"
                spacing: dp(10)
                size_hint: 1, 1

                SegmentedControl:
                    id: nav
                    size_hint_y: None
                    height: dp(46)

                Widget:
                    size_hint_y: 1

                RecycleView:
                    id: rv
                    size_hint_y: None
                    height: dp(330)
                    bar_width: dp(6)
                    scroll_type: ["bars", "content"]
                    viewclass: "ForecastRow"
                    data: root.forecast_items

                    RecycleBoxLayout:
                        orientation: "vertical"
                        default_size: None, dp(66)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(0)

                Widget:
                    size_hint_y: 1

                AnchorLayout:
                    id: frog_slot
                    anchor_x: "right"
                    anchor_y: "bottom"
                    size_hint_y: None
                    height: dp(120)

                    Image:
                        source: "icons/weather-frog-removebg-preview.png"
                        size_hint: None, None
                        size: dp(110), dp(110)
                        allow_stretch: True
                        keep_ratio: True


<WeatherRoot>:
    orientation: "vertical"

    canvas.before:
        Color:
            rgba: get_color_from_hex("#F3F7FA")
        Rectangle:
            pos: self.pos
            size: self.size

    ScreenManager:
        id: sm

        TodayScreen:
            name: "today"

        TomorrowScreen:
            name: "tomorrow"

        FiveDaysScreen:
            name: "five_days"


WeatherRoot:
